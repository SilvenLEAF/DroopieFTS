<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DroopieFTS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<div>
  <h1 class="text-center m-3">DroopieFTS</h1>

  <p id="notifPara" class="mb-0 text-center">
    Click on the following red button to sync your Dropbox account
  </p>
  <p class="mt-0 text-center"> Developed by SilvenLEAF (Manash Sarma)</p>

  <p class="text-center">
    <button id="syncBtn" class="btn btn-danger d-inline-block mx-2">Sync Your Dropbox Account</button>
  </p>
  <p class="text-center">
    <a href="http://localhost:5500/" class="btn btn-secondary d-inline-block">Go Home</a>
    <a href="http://localhost:5500/files" class="btn btn-secondary d-inline-block"
      style="margin-left: 10px !important">Files Page</a>
  </p>
  </body>

  <script>
    const syncBtn = document.querySelector('#syncBtn');
    const notifPara= document.querySelector('#notifPara');
    syncBtn.addEventListener('click', syncDropbox);

    async function syncDropbox() {
      const urlParams = new URLSearchParams(window.location.search);
      const userGivenCode = urlParams.get('code');
      const apiUrl = 'http://localhost:5500/api/v1/droopie/sync';
      try {
        notifPara.textContent = 'Dropbox is syncing please wait...';
        const syncRes = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            code: userGivenCode,
          })
        });
  
        const syncData = await syncRes.json();
        const { message } = syncData || {};
        if(message){
          notifPara.textContent = message;
          alert(message);
        }        
      } catch (error) {
        console.log(error);
        alert(error.message);
      }
    }
  </script>

</html>